FROM amazonlinux:2018.03
LABEL maintainer "Cheewai Lai <cheewai.lai@gmail.com>"

ARG DOCKERIZE_VERSION=v0.6.1

RUN yum -y install epel-release \
 && yum -y update \
 && yum -y install \
ImageMagick-6.7.8.9 \
acl-2.2.49 \
acpid-2.0.19 \
alsa-lib-1.0.22 \
apr-1.5.1 \
apr-util-1.4.1 \
at-3.1.10 \
attr-2.4.46 \
audit-2.6.5 \
audit-libs-2.6.5 \
authconfig-6.2.8 \
autoconf-2.69 \
autogen-libopts-5.18 \
automake-1.13.4 \
automake19-1.9.6 \
avahi-libs-0.6.25 \
aws-amitools-ec2-1.5.12 \
aws-apitools-as-1.0.61.6 \
aws-apitools-common-1.1.0 \
aws-apitools-ec2-1.7.3.0 \
aws-apitools-elb-1.0.35.0 \
aws-apitools-mon-1.0.20.0 \
aws-cfn-bootstrap-1.4 \
aws-cli-1.11.29 \
aws-cli-plugin-cloudwatch-logs-1.3.3 \
awslogs-1.1.2 \
basesystem-10.0 \
bash-4.2.46 \
bc-1.06.95 \
binutils-2.23.52.0.1 \
bzip2-1.0.6 \
bzip2-libs-1.0.6 \
ca-certificates-2015.2.6 \
cairo-1.12.14 \
checkpolicy-2.1.10 \
chkconfig-1.3.49.3 \
cloud-disk-utils-0.27 \
cloud-init-0.7.6 \
coreutils-8.22 \
cpio-2.10 \
cpp48-4.8.3 \
cracklib-2.8.16 \
cracklib-dicts-2.8.16 \
cronie-1.4.4 \
cronie-anacron-1.4.4 \
crontabs-1.10 \
cryptsetup-1.6.7 \
cryptsetup-libs-1.6.7 \
cups-libs-1.4.2 \
curl-7.51.0 \
cvs-1.11.23 \
cyrus-sasl-2.1.23 \
cyrus-sasl-lib-2.1.23 \
cyrus-sasl-plain-2.1.23 \
dash-0.5.5.1 \
db4-4.7.25 \
db4-utils-4.7.25 \
dbus-1.6.12 \
dbus-libs-1.6.12 \
dejavu-fonts-common-2.33 \
dejavu-sans-fonts-2.33 \
dejavu-sans-mono-fonts-2.33 \
dejavu-serif-fonts-2.33 \
device-mapper-1.02.135 \
device-mapper-event-1.02.135 \
device-mapper-event-libs-1.02.135 \
device-mapper-libs-1.02.135 \
device-mapper-persistent-data-0.6.3 \
diffutils-3.3 \
dmraid-1.0.0.rc16 \
dmraid-events-1.0.0.rc16 \
dos2unix-3.1 \
dracut-004 \
dracut-modules-growroot-0.20 \
e2fsprogs \
e2fsprogs-libs \
ec2-net-utils-0.5 \
ec2-utils-0.5 \
ed-1.1 \
elfutils-libelf-0.163 \
emacs-24.3 \
emacs-common-24.3 \
emacs-git-2.7.4 \
epel-release \
ethtool-3.15 \
expat-2.1.0 \
file-5.22 \
file-libs-5.22 \
filesystem-2.4.30 \
findutils-4.4.2 \
fipscheck-1.3.1 \
fipscheck-lib-1.3.1 \
fontconfig-2.8.0 \
fontpackages-filesystem-1.41 \
freetype-2.3.11 \
gawk-3.1.7 \
gcc-4.8.3 \
gcc-c++-4.8.3 \
gcc48-4.8.3 \
gcc48-c++-4.8.3 \
gdbm-1.8.0 \
gdisk-0.8.10 \
generic-logos-17.0.0 \
get_reference_source-1.2 \
ghostscript-8.70 \
ghostscript-fonts-5.50 \
giflib-4.1.6 \
git-2.7.4 \
git-all-2.7.4 \
git-cvs-2.7.4 \
git-email-2.7.4 \
git-p4-2.7.4 \
git-svn-2.7.4 \
glib2-2.36.3 \
glibc-2.17 \
glibc-common-2.17 \
glibc-devel-2.17 \
glibc-headers-2.17 \
gmp-6.0.0 \
gnupg2-2.0.28 \
gnutls-2.12.23 \
gpgme-1.4.3 \
gpm-libs-1.20.6 \
grep-2.20 \
groff-1.22.2 \
groff-base-1.22.2 \
grub-0.97 \
grubby-7.0.15 \
gzip-1.5 \
hesiod-3.1.0 \
hmaccalc-0.9.12 \
httpd24-2.4.25 \
httpd24-tools-2.4.25 \
hwdata-0.233 \
info-5.1 \
initscripts-9.03.49 \
iproute-4.4.0 \
iptables-1.4.18 \
iputils-20121221 \
irqbalance-1.1.0 \
jasper-libs-1.900.1 \
java-1.7.0-openjdk-1.7.0.131 \
javapackages-tools-0.9.1 \
jbigkit-libs-2.0 \
jpackage-utils-1.7.5 \
json-c-0.11 \
kbd-1.15 \
kbd-misc-1.15 \
kernel \
kernel-headers \
kernel-tools \
keyutils-1.5.8 \
keyutils-libs-1.5.8 \
keyutils-libs-devel-1.5.8 \
kmod-14 \
kmod-libs-14 \
kpartx-0.4.9 \
krb5-devel-1.14.1 \
krb5-libs-1.14.1 \
lcms2-2.6 \
less-436 \
libICE-1.0.6 \
libSM-1.2.1 \
libX11-1.6.0 \
libX11-common-1.6.0 \
libXau-1.0.6 \
libXcomposite-0.4.3 \
libXdamage-1.1.3 \
libXext-1.3.2 \
libXfixes-5.0.1 \
libXfont-1.4.5 \
libXi-1.7.2 \
libXpm-3.5.10 \
libXrender-0.9.8 \
libXt-1.1.4 \
libXtst-1.2.2 \
libXxf86vm-1.1.3 \
libacl-2.2.49 \
libaio-0.3.109 \
libassuan-2.0.3 \
libattr-2.4.46 \
libblkid-2.23.2 \
libcap-2.16 \
libcap-ng-0.7.5 \
libcgroup-0.40.rc1 \
libcom_err \
libcom_err-devel \
libcurl-7.51.0 \
libcurl-devel-7.51.0 \
libdrm-2.4.52 \
libevent-2.0.21 \
libffi-3.0.13 \
libfontenc-1.0.5 \
libgcc48-4.8.3 \
libgcrypt-1.5.3 \
libgcrypt-devel-1.5.3 \
libgomp-4.8.3 \
libgpg-error-1.11 \
libgpg-error-devel-1.11 \
libgssglue-0.1 \
libicu-50.1.2 \
libidn-1.18 \
libidn2-0.16 \
libjpeg-turbo-1.2.90 \
libkadm5-1.14.1 \
libmcrypt-2.5.8 \
libmemcached-1.0.16 \
libmount-2.23.2 \
libmpc-1.0.1 \
libnfsidmap-0.25 \
libnih-1.0.1 \
libnl-1.1.4 \
libpciaccess-0.13.1 \
libpipeline-1.2.3 \
libpng-1.2.49 \
libpsl-0.6.2 \
libpwquality-1.2.3 \
libselinux-2.1.10 \
libselinux-devel-2.1.10 \
libselinux-utils-2.1.10 \
libsemanage-2.1.6 \
libsepol-2.1.7 \
libsepol-devel-2.1.7 \
libserf-1.3.7 \
libss \
libssh2-1.4.2 \
libstdc++48-4.8.3 \
libstdc++48-devel-4.8.3 \
libsysfs-2.1.0 \
libtasn1-2.3 \
libtiff-4.0.3 \
libtirpc-0.2.4 \
libtool-ltdl-2.4.2 \
libudev-173 \
libunistring-0.9.3 \
libuser-0.60 \
libutempter-1.1.5 \
libuuid-2.23.2 \
libverto-0.2.5 \
libverto-devel-0.2.5 \
libwmf-lite-0.2.8.4 \
libxcb-1.11 \
libxml2-2.9.1 \
libxml2-devel-2.9.1 \
libxml2-python27-2.9.1 \
libxslt-1.1.28 \
libxslt-devel-1.1.28 \
libyaml-0.1.6 \
logrotate-3.7.8 \
lsof-4.82 \
lua-5.1.4 \
lvm2-2.02.166 \
lvm2-libs-2.02.166 \
m4-1.4.16 \
mailcap-2.1.31 \
make-3.82 \
man-db-2.6.3 \
man-pages-4.10 \
mdadm-3.2.6 \
mercurial-common-3.5.2 \
mercurial-python27-3.5.2 \
mesa-dri-drivers \
mesa-dri-filesystem \
mesa-dri1-drivers \
mesa-libGL \
mingetty-1.08 \
mpfr-3.1.1 \
mysql-5.5 \
mysql-config-5.5.54 \
mysql-devel-5.5 \
mysql55-5.5.54 \
mysql55-devel-5.5.54 \
mysql55-libs-5.5.54 \
nano-2.5.3 \
nc-1.84 \
ncurses-5.7 \
ncurses-base-5.7 \
ncurses-libs-5.7 \
net-tools-1.60 \
newt-0.52.11 \
newt-python27-0.52.11 \
nfs-utils-1.3.0 \
nspr-4.13.1 \
nss-3.28.4 \
nss-softokn-3.16.2.3 \
nss-softokn-freebl-3.16.2.3 \
nss-sysinit-3.28.4 \
nss-tools-3.28.4 \
nss-util-3.28.4 \
ntp-4.2.6p5 \
ntpdate-4.2.6p5 \
ntsysv-1.3.49.3 \
numactl-2.0.7 \
openldap-2.4.40 \
openssh-6.6.1p1 \
openssh-clients-6.6.1p1 \
openssh-server-6.6.1p1 \
openssl-1.0.1k \
openssl-devel-1.0.1k \
p11-kit-0.18.5 \
p11-kit-trust-0.18.5 \
pam-1.1.8 \
pam_ccreds-10 \
pam_krb5-2.3.11 \
pam_passwdqc-1.0.5 \
parted-2.1 \
passwd-0.79 \
pciutils-3.1.10 \
pciutils-libs-3.1.10 \
pcre-8.21 \
pcre-devel-8.21 \
perl-5.16.3 \
perl-Authen-SASL-2.15 \
perl-Carp-1.26 \
perl-Compress-Raw-Bzip2-2.061 \
perl-Compress-Raw-Zlib-2.061 \
perl-DBD-SQLite-1.39 \
perl-DBI-1.627 \
perl-Data-Dumper-2.145 \
perl-Digest-1.17 \
perl-Digest-HMAC-1.03 \
perl-Digest-MD5-2.52 \
perl-Digest-SHA-5.85 \
perl-Encode-2.51 \
perl-Error-0.17020 \
perl-Exporter-5.68 \
perl-File-Path-2.09 \
perl-File-Temp-0.23.01 \
perl-Filter-1.49 \
perl-GSSAPI-0.28 \
perl-Getopt-Long-2.40 \
perl-Git-2.7.4 \
perl-Git-SVN-2.7.4 \
perl-HTTP-Tiny-0.033 \
perl-IO-Compress-2.061 \
perl-IO-Socket-IP-0.21 \
perl-IO-Socket-SSL-1.94 \
perl-Net-Daemon-0.48 \
perl-Net-LibIDN-0.12 \
perl-Net-SMTP-SSL-1.01 \
perl-Net-SSLeay-1.65 \
perl-PathTools-3.40 \
perl-PlRPC-0.2020 \
perl-Pod-Escapes-1.04 \
perl-Pod-Perldoc-3.20 \
perl-Pod-Simple-3.28 \
perl-Pod-Usage-1.63 \
perl-Scalar-List-Utils-1.27 \
perl-Socket-2.010 \
perl-Storable-2.45 \
perl-TermReadKey-2.30 \
perl-Test-Harness-3.28 \
perl-Text-ParseWords-3.29 \
perl-Thread-Queue-3.02 \
perl-Time-HiRes-1.9725 \
perl-Time-Local-1.2300 \
perl-YAML-0.84 \
perl-constant-1.27 \
perl-libs-5.16.3 \
perl-macros-5.16.3 \
perl-parent-0.225 \
perl-podlators-2.5.1 \
perl-threads-1.87 \
perl-threads-shared-1.43 \
pinentry-0.7.6 \
pixman-0.32.4 \
pkgconfig-0.27.1 \
policycoreutils-2.1.12 \
popt-1.13 \
postgresql8-libs-8.4.20 \
procmail-3.22 \
procps-3.2.8 \
psacct-6.3.2 \
psmisc-22.20 \
pth-2.0.7 \
python27-2.7.12 \
python27-PyYAML-3.10 \
python27-babel-0.9.4 \
python27-backports-1.0 \
python27-backports-ssl_match_hostname-3.4.0.2 \
python27-boto-2.42.0 \
python27-botocore-1.4.86 \
python27-chardet-2.0.1 \
python27-colorama-0.2.5 \
python27-configobj-4.7.2 \
python27-crypto-2.6.1 \
python27-daemon-1.5.2 \
python27-dateutil-2.1 \
python27-devel-2.7.12 \
python27-docutils-0.11 \
python27-ecdsa-0.11 \
python27-futures-3.0.3 \
python27-imaging-1.1.6 \
python27-iniparse-0.3.1 \
python27-jinja2-2.7.2 \
python27-jmespath-0.9.0 \
python27-jsonpatch-1.2 \
python27-jsonpointer-1.0 \
python27-kitchen-1.1.1 \
python27-libs-2.7.12 \
python27-lockfile-0.8 \
python27-markupsafe-0.11 \
python27-paramiko-1.15.1 \
python27-pip-6.1.1 \
python27-ply-3.4 \
python27-pyasn1-0.1.7 \
python27-pycurl-7.19.0 \
python27-pygpgme-0.3 \
python27-pyliblzma-0.5.3 \
python27-pystache-0.5.3 \
python27-pyxattr-0.5.0 \
python27-requests-1.2.3 \
python27-rsa-3.4.1 \
python27-setuptools-12.2 \
python27-simplejson-3.6.5 \
python27-six-1.8.0 \
python27-urlgrabber-3.10 \
python27-urllib3-1.8.2 \
python27-virtualenv-12.0.7 \
quota-4.00 \
quota-nls-4.00 \
readline-6.2 \
rng-tools-5 \
rootfiles-8.1 \
rpcbind-0.2.0 \
rpm-4.11.3 \
rpm-build-libs-4.11.3 \
rpm-libs-4.11.3 \
rpm-python27-4.11.3 \
rsync-3.0.6 \
rsyslog-5.8.10 \
ruby-2.0 \
ruby-devel-2.0 \
ruby20-2.0.0.648 \
ruby20-devel-2.0.0.648 \
ruby20-irb-2.0.0.648 \
ruby20-libs-2.0.0.648 \
rubygem-json-2.0 \
rubygem20-bigdecimal-1.2.0 \
rubygem20-json-1.8.3 \
rubygem20-psych-2.0.0 \
rubygem20-rdoc-4.2.2 \
rubygems-2.0 \
rubygems20-2.0.14.1 \
screen-4.0.3 \
sed-4.2.1 \
sendmail-8.14.4 \
setserial-2.17 \
setup-2.8.14 \
sgpio-1.2.0.10 \
shadow-utils-4.1.4.2 \
shared-mime-info-1.1 \
slang-2.2.1 \
sqlite-3.7.17 \
subversion-1.9.5 \
subversion-libs-1.9.5 \
subversion-perl-1.9.5 \
sudo-1.8.6p3 \
sysctl-defaults-1.0 \
sysfsutils-2.1.0 \
t1lib-5.1.2 \
tar-1.26 \
tcp_wrappers-7.6 \
tcp_wrappers-libs-7.6 \
time-1.7 \
tmpwatch-2.9.16 \
traceroute-2.0.14 \
tree-1.6.0 \
ttmkfdir-3.0.9 \
tzdata-2017b \
tzdata-java-2017b \
udev-173 \
unixODBC-2.2.14 \
unzip-6.0 \
update-motd-1.0.1 \
upstart-0.6.5 \
urw-fonts-2.4 \
ustr-1.0.4 \
util-linux-2.23.2 \
uuid-1.6.2 \
uuid-php56-1.6.2 \
vim-common-8.0.0503 \
vim-enhanced-8.0.0503 \
vim-filesystem-8.0.0503 \
vim-minimal-8.0.0503 \
wget-1.18 \
which-2.19 \
words-3.0 \
xorg-x11-font-utils-7.2 \
xorg-x11-fonts-Type1-7.2 \
yum-3.4.3 \
yum-metadata-parser-1.1.4 \
yum-plugin-priorities-1.1.31 \
yum-plugin-upgrade-helper-1.1.31 \
yum-utils-1.1.31 \
zip-3.0 \
zlib-1.2.8 \
zlib-devel-1.2.8

RUN yum -y install \
php-channel-amazon-1.0 \
php-channel-ezc-1 \
php-channel-phpunit-1.3 \
php-channel-symfony-1.3 \
php-pear-1.10.1 \
php-symfony-YAML-1.0.6 \
php56-5.6.30 \
php56-bcmath-5.6.30 \
php56-cli-5.6.30 \
php56-common-5.6.30 \
php56-devel-5.6.30 \
php56-gd-5.6.30 \
php56-intl-5.6.30 \
php56-jsonc-1.3.6 \
php56-jsonc-devel-1.3.6 \
php56-mbstring-5.6.30 \
php56-mcrypt-5.6.30 \
php56-mysqlnd-5.6.30 \
php56-odbc-5.6.30 \
php56-opcache-5.6.30 \
php56-pdo-5.6.30 \
php56-pecl-apcu-4.0.7 \
php56-pecl-igbinary-1.2.1 \
php56-pecl-imagick-3.1.2 \
php56-pecl-memcache-3.0.8 \
php56-pecl-memcached-2.2.0 \
php56-pecl-oauth-1.2.3 \
php56-pecl-ssh2-0.12 \
php56-pgsql-5.6.30 \
php56-process-5.6.30 \
php56-soap-5.6.30 \
php56-xml-5.6.30 \
php56-xmlrpc-5.6.30 \
 && yum -y clean all

# Composer version 1.4.1 2017-03-10 09:29:45
# Install Composer
RUN curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/bin --filename=composer.phar

RUN \
 export COMPOSER_HOME=/root && /usr/bin/composer.phar self-update && \
 pecl channel-update pecl.php.net

RUN wget https://github.com/jwilder/dockerize/releases/download/$DOCKERIZE_VERSION/dockerize-linux-amd64-$DOCKERIZE_VERSION.tar.gz && \
 tar -C /usr/local/bin -xzvf dockerize-linux-amd64-$DOCKERIZE_VERSION.tar.gz && \
 rm dockerize-linux-amd64-$DOCKERIZE_VERSION.tar.gz

RUN wget -O /usr/local/bin/gosu https://github.com/tianon/gosu/releases/download/1.12/gosu-amd64 

# Merge addition and modification into existing /etc/
COPY ./etc /etc

RUN update-ca-trust
